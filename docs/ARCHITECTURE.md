# 아키텍처 문서

프롬프트 생성기 서비스의 시스템 아키텍처를 설명하는 문서입니다.

## 📋 목차

- [시스템 개요](#시스템-개요)
- [아키텍처 다이어그램](#아키텍처-다이어그램)
- [주요 컴포넌트](#주요-컴포넌트)
- [데이터 흐름](#데이터-흐름)
- [보안 아키텍처](#보안-아키텍처)
- [확장성 고려사항](#확장성-고려사항)

---

## 시스템 개요

프롬프트 생성기는 **모놀리식 아키텍처**를 기반으로 하며, 프론트엔드와 백엔드가 분리된 구조입니다.

### 기술 스택

- **프론트엔드**: React 18 + TypeScript + Vite
- **백엔드**: Express 5 + Node.js 20 + TypeScript
- **데이터베이스**: PostgreSQL + Prisma ORM
- **인증**: JWT (Access Token + Refresh Token)
- **배포**: Vercel (프론트), Railway (백엔드)

---

## 아키텍처 다이어그램

### 전체 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│                    사용자 (브라우저)                      │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│              프론트엔드 (Vercel)                         │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │  React   │  │  Vite    │  │  API     │             │
│  │  App     │  │  Build   │  │  Client  │             │
│  └──────────┘  └──────────┘  └──────────┘             │
└────────────────────┬────────────────────────────────────┘
                     │ HTTPS
                     │ API 요청
                     ▼
┌─────────────────────────────────────────────────────────┐
│              백엔드 (Railway)                             │
│  ┌──────────────────────────────────────────┐          │
│  │         Express 서버                      │          │
│  │  ┌──────────┐  ┌──────────┐            │          │
│  │  │ Helmet   │  │ Rate     │            │          │
│  │  │ (보안)   │  │ Limit    │            │          │
│  │  └──────────┘  └──────────┘            │          │
│  │  ┌──────────────────────────┐          │          │
│  │  │      미들웨어 스택        │          │          │
│  │  │  - CORS                   │          │          │
│  │  │  - 인증 (JWT)             │          │          │
│  │  │  - 검증                   │          │          │
│  │  │  - RBAC                   │          │          │
│  │  └──────────────────────────┘          │          │
│  │  ┌──────────────────────────┐          │          │
│  │  │      API 라우트          │          │          │
│  │  │  - /api/auth             │          │          │
│  │  │  - /api/users            │          │          │
│  │  │  - /api/prompts          │          │          │
│  │  │  - /api/templates        │          │          │
│  │  │  - /api/admin            │          │          │
│  │  └──────────────────────────┘          │          │
│  └──────────────────────────────────────────┘          │
│                     │                                    │
│                     ▼                                    │
│  ┌──────────────────────────────────────────┐          │
│  │         서비스 레이어                    │          │
│  │  - Logger                                │          │
│  │  - Encryption                            │          │
│  │  - Guide Service                         │          │
│  └──────────────────────────────────────────┘          │
│                     │                                    │
│                     ▼                                    │
│  ┌──────────────────────────────────────────┐          │
│  │         Prisma ORM                        │          │
│  └──────────────────────────────────────────┘          │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│              PostgreSQL (Railway)                       │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │  Users   │  │ Prompts  │  │Templates │             │
│  │  Workspaces│ │Versions │  │  Guides  │             │
│  └──────────┘  └──────────┘  └──────────┘             │
└─────────────────────────────────────────────────────────┘
```

### 레이어 구조

```
┌─────────────────────────────────────┐
│      Presentation Layer              │  ← React Components
├─────────────────────────────────────┤
│      Application Layer              │  ← API Routes, Business Logic
├─────────────────────────────────────┤
│      Domain Layer                   │  ← Services, Utilities
├─────────────────────────────────────┤
│      Infrastructure Layer           │  ← Prisma, Database
└─────────────────────────────────────┘
```

---

## 주요 컴포넌트

### 1. 프론트엔드 (React)

#### 컴포넌트 계층

```
App
├── PromptGenerator (텍스트)
├── ImagePromptGenerator (이미지)
├── VideoPromptGenerator (동영상)
├── EngineeringPromptGenerator (엔지니어링)
├── TemplateGallery (템플릿)
└── AdminDashboard (관리자)
```

#### 상태 관리

- **로컬 상태**: React Hooks (useState, useReducer)
- **전역 상태**: Context API (AuthContext)
- **서버 상태**: API 호출 (fetch)

### 2. 백엔드 (Express)

#### 미들웨어 스택

1. **Helmet**: 보안 헤더
2. **Rate Limiting**: DDoS 방어
3. **CORS**: Cross-Origin 요청 처리
4. **Body Parser**: JSON 파싱
5. **인증**: JWT 검증
6. **검증**: 입력 검증 및 Sanitization
7. **RBAC**: 역할 기반 접근 제어
8. **에러 핸들러**: 전역 에러 처리

#### 라우트 구조

```
/api
├── /auth          # 인증 (회원가입, 로그인, 토큰 갱신)
├── /users         # 사용자 관리 (프로필, API 키)
├── /prompts       # 프롬프트 관리 (CRUD)
├── /templates     # 템플릿 관리
├── /admin         # 관리자 기능
├── /guides        # 프롬프트 가이드
└── /ai-services   # AI 서비스 정보
```

### 3. 데이터베이스 (PostgreSQL)

#### 주요 테이블

- **User**: 사용자 정보
- **Prompt**: 프롬프트
- **Template**: 템플릿
- **Workspace**: 워크스페이스
- **PromptGuide**: 프롬프트 가이드
- **AIService**: AI 서비스 정보

---

## 데이터 흐름

### 프롬프트 생성 플로우

```
1. 사용자 입력
   ↓
2. 프론트엔드 검증
   ↓
3. API 요청 (POST /api/prompts)
   ↓
4. 인증 미들웨어 (JWT 검증)
   ↓
5. 입력 검증 미들웨어
   ↓
6. RBAC 권한 확인
   ↓
7. 비즈니스 로직 처리
   ↓
8. Prisma ORM 쿼리
   ↓
9. 데이터베이스 저장
   ↓
10. 응답 반환 (JSON)
   ↓
11. 프론트엔드 표시
```

### 인증 플로우

```
1. 로그인 요청 (POST /api/auth/login)
   ↓
2. 이메일/비밀번호 검증
   ↓
3. bcrypt 비밀번호 확인
   ↓
4. Access Token 생성 (15분)
   ↓
5. Refresh Token 생성 (7일)
   ↓
6. 응답 반환
   ↓
7. 프론트엔드 토큰 저장
   ↓
8. 이후 요청에 토큰 포함
```

---

## 보안 아키텍처

### 보안 레이어

```
┌─────────────────────────────────────┐
│  Network Layer (HTTPS)              │  ← TLS 암호화
├─────────────────────────────────────┤
│  Application Layer                 │
│  - Helmet (보안 헤더)               │
│  - Rate Limiting                    │
│  - CORS                             │
├─────────────────────────────────────┤
│  Authentication Layer               │
│  - JWT 검증                         │
│  - Refresh Token                    │
├─────────────────────────────────────┤
│  Authorization Layer               │
│  - RBAC                             │
│  - 리소스 권한 확인                 │
├─────────────────────────────────────┤
│  Validation Layer                   │
│  - 입력 검증                        │
│  - XSS 방지                         │
│  - SQL Injection 방지 (Prisma)     │
└─────────────────────────────────────┘
```

### 데이터 보안

- **전송 중**: HTTPS (TLS)
- **저장 시**: 
  - 비밀번호: bcrypt 해싱
  - API 키: 향후 해시 저장 예정
  - 민감한 데이터: 암호화 유틸리티 제공

---

## 확장성 고려사항

### 현재 구조

- 모놀리식 아키텍처
- 단일 데이터베이스
- 수직 확장 (Vertical Scaling)

### 향후 확장 방안

1. **수평 확장**
   - 로드 밸런서 추가
   - 여러 서버 인스턴스

2. **캐싱**
   - Redis 도입
   - 자주 조회되는 데이터 캐싱

3. **마이크로서비스 전환** (장기)
   - 인증 서비스 분리
   - 프롬프트 생성 서비스 분리
   - 템플릿 서비스 분리

4. **CDN**
   - 정적 자산 CDN 배포
   - 이미지 최적화

---

## 성능 최적화

### 현재 적용된 최적화

- 코드 스플리팅 (Vite)
- 데이터베이스 인덱스
- Prisma 쿼리 최적화
- Rate Limiting

### 향후 개선 사항

- Redis 캐싱
- 데이터베이스 연결 풀 최적화
- API 응답 압축 (gzip, brotli)
- 이미지 최적화 (WebP)

---

**마지막 업데이트**: 2025-01-XX
